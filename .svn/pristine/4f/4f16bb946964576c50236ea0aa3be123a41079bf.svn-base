/*
 * az61.ui.longterm
 *
 * Created: 28.10.2013
 * Author: Rebeca Kurz <rk@inmedias.de>
 * Company: team in medias GmbH
 */

$(function() {
	$('.checkAnswer').on('click',function(event){
		var liId = '';
		var learnItemId = 0;
		
		$('.longtermContent').find('li').each(function(){
		    if ($(this).css('position') == 'relative') {
		        liId = $(this).find('div.question').attr('id');
		        learnItemId = liId.substring(18);
		    }
		});
		//$('.longtermContent').find('li:visible div.question').attr('id');	    
	    //var learnItemId = liId.substring(18);
	    
	    var longtermLevel = parseInt($('#questionLearnItem_'+learnItemId+' .vocabLevel').html(),10);
	    var answerValue = $.trim($('#questionLearnItem_'+learnItemId+' .answerValue').val()).toLowerCase();
	    var answerUser = $.trim($('#answerlearnItem_'+learnItemId+' .answerUser').val()).toLowerCase();
	    console.log(answerValue);
	    
	    var resultItem = {};
	    resultItem['lastShown'] = new Date().getTime();
	    resultItem['longtermLevel'];
	    resultItem['learnItemId'] = learnItemId;
		resultItem['userId'] = loggedInUser;
	    
	    if (answerUser != '') {	        
			if (answerUser == answerValue) {
				resultItem['longtermLevel'] = raiseLongtermLevel(longtermLevel);
				UpdateResultToDB(resultItem);
				$('.longtermLearn').append('<p>Die Antwort war richtig.</p>');
			}
			else {
			    $('.longtermLearn').append('<p>Die Antwort entspricht nicht der eigentlichen Antwort.</p>');
				//Sink longterm level
				resultItem['longtermLevel'] = sinkLongtermLevel(longtermLevel);
				UpdateResultToDB(resultItem);
			}
		}
	});	
	
	$('.longtermList').on('click','.enterLongterm',function(event){
		$('div.longtermList').hide();
		$('div.longtermLearn').show();
		
		var liId = $(event.target).closest('li').attr('id');
		lessonData = {};
		lessonData['lessonId'] = liId.substring(9);
		console.log(lessonData['lessonId']);
		GetLongtermFromLesson(loggedInUser, lessonData);
	});
	
});

function raiseLongtermLevel(longtermLevel) {
	if (longtermLevel > 0) {
		longtermLevel--;
	}
	var newLevel = longtermLevel;
	return newLevel;
}

function sinkLongtermLevel(longtermLevel) {
	if (longtermLevel < 6) {
		longtermLevel++;
	}
	var newLevel = longtermLevel;
	return newLevel;
}